version: 1

# Deployment to compile node project and install on a jails, copy to jail and run the webserver
metadata:
  name: "yoonka-webserver"

project:
  name: "yoonka-webserver"
  namespace: "yoonka-webserver"

  working_dir: temp/yoonka-webserver

  git:
    source: "https://github.com/nguthiru/receipt_generator.git"
    branch: "master"

  workflow:
    - install:
        runner: "npm"
        command: "install"
        
    # - test:
    #     runner: "npm"
    #     command: "run test"

    - build:
        runner: "npm"
        command: "run build"

  jails:
    name: "yoonka-webserver"

    config:
      interface: "igb0"
      ip:
        inherit: true
        # address: ""
    dependencies:
      pkg:
        - name: "node"
          version: "latest"
        - name: "npm"
          version: "latest"
        - name: "nginx"
          version: "latest"
    copy:
      - from: "./dist"
        to: "/usr/local/www/nginx"
    commands:
      - "cp -r ./dist /usr/local/www/nginx"
      - "nginx -s reload"
